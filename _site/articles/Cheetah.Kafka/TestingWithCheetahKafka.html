<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Testing with Cheetah.Kafka | Cheetah Nuget Packages </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Testing with Cheetah.Kafka | Cheetah Nuget Packages ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/KastTrifork/cheetah-lib-shared-dotnet/blob/main/docs/articles/Cheetah.Kafka/TestingWithCheetahKafka.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="testing-with-cheetahkafka">Testing with Cheetah.Kafka</h1>

<p>In order to easily test other components which communicate with Kafka, Cheetah.Kafka includes a simple way to generate test clients that can be used to verify the behavior of other components.</p>
<div class="CAUTION">
<h5>Caution</h5>
<p>The clients generated using the methods described here are intended to be short-lived and used solely for testing purposes. They have not been tested to work in long-running applications and should not be used in production scenarios. Instead, use the clients registered through <code>serviceCollection.AddCheetahKafka()</code>;</p>
</div>
<p>To get started we first create a <code>KafkaTestClientFactory</code>. This requires either a <code>KafkaConfig</code> instance or an <code>IConfiguration</code> with the same configuration requirements as described in <a href="UsingCheetahKafka.html#configuration">Using Cheetah.Kafka | Configuration</a>.</p>
<pre><code class="lang-csharp">var configuration = new ConfigurationBuilder()
    .AddJsonFile(&quot;appsettings.Test.json&quot;)
    .AddEnvironmentVariables()
    .Build();

var testClientFactory = KafkaTestClientFactory.Create(configuration);
</code></pre>
<h2 id="creating-writers-and-readers">Creating writers and readers</h2>
<p>With a <code>KafkaTestClientFactory</code> in hand, test writers and readers are easily created using the <code>CreateTestReader</code> and <code>CreateTestWriter</code> methods.</p>
<p>The example below creates a reader and a writer, both reading from and writing to the <code>MyTopic</code> topic, with the reader joining the <code>MyConsumerGroup</code> consumer group.</p>
<p>It then writes a message to the topic using the writer and retrieves the message using the reader, expecting 1 message with a maximum timeout of 5 seconds.</p>
<pre><code class="lang-csharp">var writer = testClientFactory.CreateTestWriter&lt;ExampleModel&gt;(&quot;MyTopic&quot;);
var reader = testClientFactory.CreateTestReader&lt;ExampleModel&gt;(&quot;MyTopic&quot;, &quot;MyConsumerGroup&quot;)

var message = new Message&lt;Null, ExampleModel&gt;()
{
    Value = new ExampleModel()
};

await Writer.WriteAsync(message);

var messages = reader.ReadMessages(1, TimeSpan.FromSeconds(5));
</code></pre>
<p>The above example uses <code>null</code> keys for the messages that are sent. In order to write and read messages with keys, supply a second type parameter to the <code>CreateTestWriter</code> and <code>CreateTestReader</code> methods. When working with non Json (de)serialization, you will also need to supply key and/or value (de)serlializers:</p>
<p>Example of using a string as key, and value as integer.</p>
<pre><code class="lang-csharp">var keyedWriter = testClientFactory.CreateTestWriter&lt;string, int&gt;(&quot;MyTopic&quot;, keySerializer: Serializers.Utf8, valueSerializer: Serializers.Int32);
</code></pre>
<h2 id="creating-low-level-clients">Creating low-level clients</h2>
<p>For more advanced test cases, you might want to skip the abstraction of the <code>IKafkaTestReader</code> and <code>IKafkaTestWriter</code>, opting instead for a fully-featured <code>IConsumer</code> or <code>IProducer</code>.</p>
<p>This can be achieved through the <code>ClientFactory</code> property on the <code>KafkaTestClientFactory</code>. This exposes the internal factory used to create clients, and allows you to create consumers, producers and admin clients as well as their respective builders, allowing for more custom behavior compared to the relatively limited feature set of the writers and readers.</p>
<p>Please be reminded that clients created this way are not intended for production scenarios.</p>

</article>


        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
